#include <iostream>
 #include <fstream> // allows to read and write .txt files
#include <cmath>
#include <iomanip>
#include <cstddef>
#include <csignal>
#include <cstdio>
#include <ctime> // Biblioteca tempo
#include <string>
#include <cctype>
#include <vector>
 #include <sstream>
#include <algorithm>
#include <set>

using namespace std;

//----------------------------------------------------------------------------------------------------
/**
*Class Board represents the board of the game, allowing to define the board limits, and place the disc on the column chosen with the respective player's color
*/
class Board
{
private:
	vector <char> topline; //representa a linha vazia mais baixa (para jogar nessa quando for escolhida essa coluna, para não ter de procurar nas linhas acima)
	vector <char> ColumnLegend;
	vector< vector <string> > board;
	int numL, numC, numN;
	string emptySymbol; //flexibilidade do que é considerado espaço vazio no tabuleiro.
	int numEmptyCells; //(fica - 1 a cada jogada.Ao chegar a zero, declara empate se ninguém tiver dado.)
	string headline;
	int NumberOfBoardCells = numC * numL;

	//Guardar linha e coluna da última jogada(procurar se há vencedor, apartir dessa posição)
	int lastLine, lastColumn;
	char LastDiscSymbol;
	int ColumnSelected;
	int AI_selectedColumn;
	//Guardar LastDiscSymbol(procurar apenas o caráter do último vencedor)

public:
	Board(int numL, int numC, char emptySymbol, int winnersequencelength);
	void SetEmptySymbol();
	void SetNumLines();
	void SetNumColumns();
	void SetConditionsForWinner();
	int GetNumLines() const;
	int GetNumColumns() const;
	string	GetEmptySymbol() const;
	void Headline() const;
	int	GetTopLineIndexAtColumn() const;
	void SelectColumn(player player, int PossibleColumnSelect) const;
	void SetSelectedColumn(int PossibleSelectedColumn);
	void putDiscAtColumn(player player); //numa determinada coluna
	bool isFull(int NumberOfPlays, int NumberOfBoardCells) const; //testar se board está cheio
	void show() const; //mostrar board
	string isThereAWinner() const; //símbolo do vencedor, e linha e coluna da última jogada.
	void wouldThereBeAWinner() const; //putDisc + winner? (p/ AI) 
				//(pode estar numa classe complementar - Classe Game : encarregar - se de ver conteúdo, verificar vencedor
	void AIPlay(int selectedColumn) const;

};
//--------------------------------------------------------------------------------------
Board::Board(int numL, int numC, char emptySymbol, int winnersequencelength)
{
	this->numL = numL;
	this->numC = numC;
	this->emptySymbol = emptySymbol;
	this->board = vector <vector<string> >(numL, vector <string>(numC, emptySymbol) );
}
//--------------------------------------------------------------------------------------
void Board::SetEmptySymbol()
{ //default empty symbol is '.'
	int choose_emptysymbol;
	cout << "Choose the empty symbol you would prefer to see: 1.'.', 2.[], 3._" << endl;
	cin >> choose_emptysymbol;

	string emptySymbol;

	switch (choose_emptysymbol)
	{
	case (1):
		emptySymbol = ".";
	case(2):
		emptySymbol = "[]";
	case (3):
		emptySymbol = "_";
	case (4):
		;
		//Player chooses emptySymbol
	default:
		emptySymbol = ".";
	};
}
//--------------------------------------------------------------------------------------
void Board::SetNumLines() 
{
	int numL=0;
	while (numL < 6 || numL > 10) 
	{
		cout << "Please, set the dimensions of the board (Minimum dimension: 6x6, Maximum dimension: 10x10). Number of Lines: ";
		cin >> numL;
		if (numL < 6 || numL > 10) 
		{
			cout << "Invalid Number of Lines, must be between 6 and 10!! \n";
		}
	}
}
//--------------------------------------------------------------------------------------
void Board::SetNumColumns() 
{
	int numC;
	while (numC < 6 || numC > 10) 
	{
		cout << "Number of Columns: ";
		cin >> numC;
		if (numC < 6 || numC > 10) 
		{
			cout << "Invalid Number of Columns, must be between 6 and 10!! \n";
		}
	}
}
//--------------------------------------------------------------------------------------
void Board::SetConditionsForWinner() 
{
	int numN;
	while ( numN < 4 || numN> max(numC, numL) )
	{
		cout << "Please, choose how many consecutive symbols are needed to win (Minimun = 4):  ";
		cin >> numN;

		if (numN < 4 || numN> max(numC,numL) )
		{
			cout << "Invalid Condition!! \n";
		}
	}
}
//--------------------------------------------------------------------------------------
int Board::GetNumLines() const
{
	return this->numL;
}
//--------------------------------------------------------------------------------------
int Board::GetNumColumns() const
{
	return this->numC;
}
//--------------------------------------------------------------------------------------
string Board::GetEmptySymbol() const
{
	return this->emptySymbol;
}
//----------------------------------------------------------------------------------------------------
int Board::GetTopLineIndexAtColumn() const
{ //parameters: numC, numL, LastColumnPlayed
	//choose column, every time a play is made, we count the column it refers to
	//topline - vector<int>
	//return this-> ;
}
//-----------------------------------------------------------------------------------------------
void Board::SelectColumn(player player, int PossibleColumnSelected) const
{
	string InputedColumn = "";
	//const string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	string PlayerName = player.GetName();
	string PlayerType = player.GetPlayerType();
	int Not_found = -1;	
	int PossibleColumnSelected=-1;

			if ((PlayerType == "Human"))
			{
				while (true)
				{
					cout << "\n" << PlayerName << ", in which column, do you want to insert your piece?" << endl;
					cin >> InputedColumn;


					if ((InputedColumn.size() != 1) || (int(InputedColumn[0]) > int('z'))) // garante que o input é somente uma letra
						InputedColumn = "_"; //in this case, it will not detect the value in the headline and will output an error

					if (int(InputedColumn[0]) > int('Z')) // garante que as minusculas sejam convertidas em maiúsculas
						InputedColumn[0] = char(int(InputedColumn[0]) - 32);

					PossibleColumnSelected = int( headline.find(InputedColumn[0]) );

					if (PossibleColumnSelected == Not_found) // garante que o inputed_column averiguado encontra-se na headline
						cout << "\nError! You must insert a valid input." << endl;
					else
					{
						break;
					}
				}
			}
			else //if the player_type is AI, does nothing
				PossibleColumnSelected = AI_selectedColumn;
}
//-----------------------------------------------------------------------------------------------
void Board::SetSelectedColumn(int PossibleColumnSelected)
{	//works for both AI and Player
	this->ColumnSelected = PossibleColumnSelected;
}
//-----------------------------------------------------------------------------------------------
void Board::putDiscAtColumn(player player) 
{
	int TopLineIndex= GetTopLineIndexAtColumn();
	board[TopLineIndex][ColumnSelected] = player.GetSymbol();
}
//-----------------------------------------------------------------------------------------------
bool Board::isFull(int NumberOfPlays, int NumberOfBoardCells) const
{
	bool isFull = false;

	if (NumberOfPlays == NumberOfBoardCells)
		isFull = true;
		cout << "It is a tie! " << endl;

	//ends game
	//else, continues game
		return isFull;

}
//-----------------------------------------------------------------------------------------------
void Board::Headline() const
{
	const string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	string headline = alphabet.substr(0, GetNumColumns() - 1); //creates substring, according to the number of columns in the board. 
	this->headline;
}
//-----------------------------------------------------------------------------------------------
void Board::show() const
{
	//string line = "";
	//for (int i = 0; i<numL; i++)
	//{
	//	line = line + board[i];
	//}
	//cout << '\n';

	cout << headline << endl;;

	for (int col = 0; col < numC; col++) //outputs board
		for (int lin = 0; lin < numL; lin++)
		{
			if (col == numC - 1) //if it's a value in the last column, goes to the next line
				cout << ' ' << board.at(col).at(lin) << endl;
			else
				cout << ' ' << board.at(col).at(lin) << ' ';
		}

	cout << headline << endl;;

}
//-----------------------------------------------------------------------------------------------
string Board::isThereAWinner() const
{
	//checking for horizontal win:
	string lineWin = "";
	for (int lin = 0; lin < GetNumLines() - 1; lin++)

		vector< vector <string> > poard; //?????????????
		
		vector< int> possibleHorizontalWins;
		possibleHorizontalWins=vector <int>(numL, 0);
		vector<int> possibleVerticalWins=vector <int>(numC, 0);;
		vector<int> possibleDiagonalWinsRightToLeft; // (\)
		vector<int> possibleDiagonalWinsLeftToRight; // (/)
		string linWin = "";
		string ColWin = "";
		int NotFoundInStr = string::npos;
			
		// Iterator for each vector inside the 2-D vector
		vector<string>::const_iterator horizontal_it;

		string winnerSequence1 = "XXXX";
		string winnerSequence2 = "OOOO";
		//horizontal_it = board[lin].begin();

			// Vitória horizontal
			for (int lin = 0; lin < numL; lin++)
			{
				possibleHorizontalWins.at(lin) = 0;
				for (horizontal_it= board[lin].begin(); horizontal_it != board[lin].end(); horizontal_it++)
				{
					linWin = linWin + *horizontal_it;
					if (linWin.find( winnerSequence1) == NotFoundInStr)
						possibleHorizontalWins.at(lin) = 0;
					else
						possibleHorizontalWins.at(lin) = 1;


					if ((linWin.find( winnerSequence2) == NotFoundInStr) && (possibleHorizontalWins.at(lin)!= 1))
						possibleHorizontalWins.at(lin) = 0;
					else if (possibleHorizontalWins.at(lin) != 1)
						possibleHorizontalWins.at(lin) = -1;


				}
				//cout << "\n\n" << linWin << endl;
				linWin = ""; //cleaning after each iteration

			}

			// Iterator for the 2-D vector
			vector<vector<string>>::const_iterator vertical_it;

			vector<string> boardLine;
			boardLine = vector <string>(numC, "");

			// Vitória vertical
			for (int col = 0; col < numC; col++)
			{
				for (vertical_it = board.begin(); vertical_it != board.end(); vertical_it++)
				{
					boardLine = *vertical_it; //analyses each line of the board and takes the 1st element, forming the 1st column. Keeps going for every column. 
					ColWin = ColWin + boardLine.at(col);
					if (ColWin.find(winnerSequence1) == NotFoundInStr)
						possibleVerticalWins.at(col) = 0;
					else
						possibleVerticalWins.at(col) = 1;

					if ((ColWin.find(winnerSequence2) == NotFoundInStr) && (possibleVerticalWins.at(col) != 1))
						possibleVerticalWins.at(col) = 0;
					else if (possibleVerticalWins.at(col) != 1)
						possibleVerticalWins.at(col) = -1;

				}
				ColWin = ""; //cleaning
		}


			return string ColWin;
}
//-----------------------------------------------------------------------------------------------
void Board::wouldThereBeAWinner() const
{
	vector < vector <string> > test_board= board;

	for (int col = 0; col < numC; col++)
	{
		int lin = GetTopLineIndexAtColumn();
		test_board.at(lin).at(col) = "X";
		//string isThereAWinnerResult= isThereAWinner(test_board);

	}
	
}
//-----------------------------------------------------------------------------------------------
void Board::AIPlay(int selectedColumn) const
{
	wouldThereBeAWinner();
}
//-----------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------
class player
{
public:
	player(int player_number, string symbol, string player_type);
	void InputName();
	string GetName();
	int GetNumber();
	string GetSymbol();
	string GetColour();
	string GetPlayerType();
	void SetPlayerType(string type);

private:
	int player_number; // 1 or 2
	string name;
	string symbol; // 'X' or 'O'
	string colour; // 'red' or 'blue'
	string player_type; // "Human", "Computer_Easy", "Computer_Medium", "Computer_Hard"
	//int N_in_line
};
//----------------------------------------------------------------------------------------------------
player::player(int player_num, string symbol, string player_type)
{
	this->player_number = player_num;
	this->symbol = symbol;
	this->player_type = player_type;
	this->name = "";

	if (symbol == "X")
		this->colour = "red";
	else if (symbol == "O")
		this->colour = "blue";
}
//----------------------------------------------------------------------------------------------------
void player::InputName()
{
	if (this->player_type == "Human")
	{
		int ID = this->player_number;
		cout << "\nPlayer" << ID << ", write your name: ";
		cin >> this->name;
		cout << "\nPlayer" << ID << ":" << this->name << endl;
	}

	else
	{
		this->name = this->player_type;
		cout << "\nPlayer" << this->player_number << ":" << this->name << endl;
	}

}
//----------------------------------------------------------------------------------------------------
int player::GetNumber()
{
	return this->player_number;
}
//---------------------------------------------------------------------------------------
string player::GetColour()
{
	return this->colour;
}
//---------------------------------------------------------------------------------------
string player::GetSymbol()
{
	return this->symbol;
}
//---------------------------------------------------------------------------------------
string player::GetName()
{
	return this->name;
}
//---------------------------------------------------------------------------------------
string player::GetPlayerType()
{
	return this->player_type;
}
//---------------------------------------------------------------------------------------
void player::SetPlayerType(string type)
{
	this->player_type = type;
}
//-----------------------------------------------------------------------------------------------
player Menu(player Enemy_player)
{
	string GameMode = "";
	string PlayerVSPlayer = "1";
	string PlayerVSComputer = "2";
	string AI_Easy = "1";
	string AI_Medium = "2";
	string AI_Hard = "3";

	//1st Part: Choose the type of Game Mode
	while (true)
	{
		cout << "How many people are playing?\n(1-Player VS Computer | 2-Player VS Player): ";
		cin >> GameMode;
		cout << endl;

		if (GameMode == PlayerVSPlayer)
		{
			Enemy_player.SetPlayerType("Computer_Easy");
			break;
		}
		else if (GameMode == PlayerVSComputer)
		{
			Enemy_player.SetPlayerType("Human");
			break;
		}
		else
			cout << "Error! You must input 1 or 2." << endl;
	}

	//2nd Part: Select Game Difficulty, in case of Player VS Computer
	if (Enemy_player.GetPlayerType() != "Human")
		while (true)
		{
			cout << "How difficult do you want the game to be?\n(1-Easy | 2-Medium | 3-Hard) ";
			cin >> GameMode;

			if (GameMode == AI_Easy)
			{
				Enemy_player.SetPlayerType("Computer_Easy");
				break;
			}

			else if (GameMode == AI_Medium)
			{
				Enemy_player.SetPlayerType("Computer_Medium");
				break;
			}

			else if (GameMode == AI_Hard)
			{
				Enemy_player.SetPlayerType("Computer_Hard");
				break;
			}

			else
				cout << "Error! You must input 1 , 2 or 3." << endl;

		}

	return Enemy_player;

}
//-----------------------------------------------------------------------------------------------
void Game()
{
	int NumberOfBoardCells = board.GetNumLines() * board.GetNumColumns();
	int NumberOfPlays = 0;

	//Game Set-Up
	player player1 = player(1, "X", "Human");
	player player2 = player(2, "O", "Human");
	player2 = Menu(player2); //Menu() - asks player game mode, name, choose board size, etc 
	player1.InputName();
	player2.InputName();
	board.SetEmptySymbol();
	board.SetNumLines(); //user chooses board size
	board.SetNumColumns();
	board.SetConditionsForWinner(); //user chooses winner length sequence

	//Game Start
	while (true)
	{
		string GameResult = "No Winner Yet";
		board.show(); //shows board with headline directly above and below
		board.selectColumn();
		board.putDiscAtColumn();
		NumberOfPlays = NumberOfPlays+1;
		GameResult = board.isThereAWinner(); //tests if there is a winner

		if (GameResult == "IsWinner")
			GameEnd(); //game ends

		else
		{
		 string IsThereATie = board.isFull(NumberOfPlays, NumberOfBoardCells);
		 if (IsThereATie == "It's a Tie!")
			 GameEnd(); //game ends
		}

	}
}
//-----------------------------------------------------------------------------------------------
void GameEnd()
{
	//cout << "\n\n\n           " << player1.name << ", you WON!\n\n\n";
	//FILE* arq;
	//arq = fopen("winner.txt", "wt"); //abre arquivo ou cria um
	//if (arq == NULL) {
	//	printf("Erro ao abrir o arquivo\n");
	//	exit(0);
	//}
	//fprintf(arq, "The winner is: ");
	//fprintf(arq, "%s", player1.name.c_str()); //grava variavel no arquivo
	//fclose(arq); //fecha o arquivo} 
	//GameON = 0;
	//break;

}
//-----------------------------------------------------------------------------------------------
int main()
{
	srand(unsigned( time(NULL) ) ); //verificar que é aqui que o prof quer ter 

	Game();
	return 0;
}
